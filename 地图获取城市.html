<!DOCTYPE html>
<html lang="en">
<!-- https://www.jianshu.com/p/956aeb07a9c3 -->

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<script>
  var getUserIP = (onNewIP) => {
    const myPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
    const pc = new myPeerConnection({ iceServers: [] });
    const noop = function () { };
    const localIPs = {};
    const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g;
    const key = null;

    function iterateIP(ip) {
      if (!localIPs[ip]) onNewIP(ip);
      localIPs[ip] = true;
    }

    pc.createDataChannel("");

    pc.createOffer().then((sdp) => {
      sdp.sdp.split('\n').forEach((line) => {
        if (line.indexOf('candidate') < 0) return;
        line.match(ipRegex).forEach(iterateIP);
      });
      pc.setLocalDescription(sdp, noop, noop);
    }).catch((reason) => { });

    pc.onicecandidate = function (ice) {
      if (!ice || !ice.candidate || !ice.candidate.candidate || !ice.candidate.candidate.match(ipRegex)) return;
      ice.candidate.candidate.match(ipRegex).forEach(iterateIP);
    };
  }

  getUserIP((ip) => {
    showIp(ip);
  });
</script>


<body>
  <p>百度地图获取城市</p>
  <a href="https://www.cnblogs.com/mickybg/p/9234683.html">https://www.cnblogs.com/mickybg/p/9234683.html</p>
</body>

</html>